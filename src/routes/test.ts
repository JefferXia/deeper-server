import express from 'express';
import logger from '../utils/logger';
import db from '../db/index';
import { eq } from 'drizzle-orm';
import { videos } from '../db/schema';
import crypto from 'crypto';

const router = express.Router();

router.get('/', async (req, res) => {
  try {
    const id = crypto.randomBytes(7).toString('hex');
    await db
      .insert(videos)
      .values({
        id,
        url: "localhost:3001/static/downloads/7412309962103213345/video.mp4",
        videoId: "7412309962103213345",
        title: "哎王冠给我来一份青椒炒虾米",
        extractor: "TikTok",
        metadata: "{\"fulltitle\":\"#phimtrungquoc\",\"description\":\"#phimtrungquoc\",\"original_url\":\"https://www.tiktok.com/@shuaidabin292/video/7412309962103213345?is_from_webapp=1&sender_device=pc\",\"view_count\":329100,\"like_count\":4105,\"comment_count\":39,\"channel\":\"Shuai Dabinnn\",\"uploader\":\"shuaidabin292\",\"uploader_id\":\"7348640565359068192\",\"uploader_url\":\"https://www.tiktok.com/@shuaidabin292\",\"upload_date\":\"20240908\",\"filesize\":7602435,\"ext\":\"mp4\",\"duration\":136,\"aspect_ratio\":0.56}",
        subtitles: "{\"result\":\"哎王冠给我来一份青椒炒虾米 我卷饼吃哦 我们没有青椒炒虾米 有小龙虾你要吗 还有奥龙波龙都是你爱吃 的啊那算了 天天吃 都吃腻了我今天就想吃青椒炒虾 米好的 啊今天那不是龙虾 这次机会来了 先生你好 你点了一份青椒炒大虾哎 你是不是进食 啊我这是青椒炒大虾吗 对啊我这是青椒多还是大虾多 哦先生你点的是大虾炒青椒 行 你去吧 哎呦大兵 你就算没有青椒炒虾米 你比我打游戏家伙 都怪我的青椒大虾太大太诱人 了你呀只能看但是不能吃 啊我这不是在玩游戏 我是在领手游内测资格 内测期间升级就送一千红包 而且上线就送价值十万元宝的 企业礼包 我得赶紧领个空气 你不信点评论区链接试试 内在期间苗林 那你现在怎么连龙虾都舍不得吃啊 以前不能吃大龙虾吗 啊我今天就想吃青椒炒阿米卷饼 我一听你说话就气的想 把你塞给抠了 拉了就拉了 还就想吃青椒炒阿米 还不是因为青椒炒阿米便宜吗 你要有我的条件 不也弄一门大虾炒青椒啊 懒得跟你讲你那也不是大虾 我这不是大虾 来我这些虾绳拿着决明吧 就我这一个虾绳都比那些虾米大 咦咋的儿子 妈妈你的青椒炒虾米来了 啊 谢谢妈妈 儿子快吃吧 这个虾米刚好给我卷一块饼 慢点吃别急 嗯哎小伙子 咋了大妈你等一会 儿子咱们这下场不要吃 一会留给你 小伙子再回去传一回青椒大肠 哈哈哈\",\"resultDetail\":[{\"startMs\":1400,\"endMs\":3760,\"startTime\":\"00:01\",\"endTime\":\"00:03\",\"text\":\"哎王冠给我来一份青椒炒虾米\"},{\"startMs\":3761,\"endMs\":5521,\"startTime\":\"00:03\",\"endTime\":\"00:05\",\"text\":\"我卷饼吃哦\"},{\"startMs\":5522,\"endMs\":7081,\"startTime\":\"00:05\",\"endTime\":\"00:07\",\"text\":\"我们没有青椒炒虾米\"},{\"startMs\":7082,\"endMs\":8281,\"startTime\":\"00:07\",\"endTime\":\"00:08\",\"text\":\"有小龙虾你要吗\"},{\"startMs\":8282,\"endMs\":10701,\"startTime\":\"00:08\",\"endTime\":\"00:10\",\"text\":\"还有奥龙波龙都是你爱吃\"},{\"startMs\":11040,\"endMs\":12120,\"startTime\":\"00:11\",\"endTime\":\"00:12\",\"text\":\"的啊那算了\"},{\"startMs\":12121,\"endMs\":12681,\"startTime\":\"00:12\",\"endTime\":\"00:12\",\"text\":\"天天吃\"},{\"startMs\":12682,\"endMs\":14681,\"startTime\":\"00:12\",\"endTime\":\"00:14\",\"text\":\"都吃腻了我今天就想吃青椒炒虾\"},{\"startMs\":14682,\"endMs\":15701,\"startTime\":\"00:14\",\"endTime\":\"00:15\",\"text\":\"米好的\"},{\"startMs\":16680,\"endMs\":19060,\"startTime\":\"00:16\",\"endTime\":\"00:19\",\"text\":\"啊今天那不是龙虾\"},{\"startMs\":19120,\"endMs\":20780,\"startTime\":\"00:19\",\"endTime\":\"00:20\",\"text\":\"这次机会来了\"},{\"startMs\":23320,\"endMs\":24040,\"startTime\":\"00:23\",\"endTime\":\"00:24\",\"text\":\"先生你好\"},{\"startMs\":24041,\"endMs\":26721,\"startTime\":\"00:24\",\"endTime\":\"00:26\",\"text\":\"你点了一份青椒炒大虾哎\"},{\"startMs\":26722,\"endMs\":28021,\"startTime\":\"00:26\",\"endTime\":\"00:28\",\"text\":\"你是不是进食\"},{\"startMs\":28040,\"endMs\":29900,\"startTime\":\"00:28\",\"endTime\":\"00:29\",\"text\":\"啊我这是青椒炒大虾吗\"},{\"startMs\":29960,\"endMs\":33900,\"startTime\":\"00:29\",\"endTime\":\"00:33\",\"text\":\"对啊我这是青椒多还是大虾多\"},{\"startMs\":35760,\"endMs\":39200,\"startTime\":\"00:35\",\"endTime\":\"00:39\",\"text\":\"哦先生你点的是大虾炒青椒\"},{\"startMs\":39201,\"endMs\":40001,\"startTime\":\"00:39\",\"endTime\":\"00:40\",\"text\":\"行\"},{\"startMs\":40520,\"endMs\":41380,\"startTime\":\"00:40\",\"endTime\":\"00:41\",\"text\":\"你去吧\"},{\"startMs\":44200,\"endMs\":45380,\"startTime\":\"00:44\",\"endTime\":\"00:45\",\"text\":\"哎呦大兵\"},{\"startMs\":45720,\"endMs\":47440,\"startTime\":\"00:45\",\"endTime\":\"00:47\",\"text\":\"你就算没有青椒炒虾米\"},{\"startMs\":47441,\"endMs\":49261,\"startTime\":\"00:47\",\"endTime\":\"00:49\",\"text\":\"你比我打游戏家伙\"},{\"startMs\":49600,\"endMs\":52940,\"startTime\":\"00:49\",\"endTime\":\"00:52\",\"text\":\"都怪我的青椒大虾太大太诱人\"},{\"startMs\":53240,\"endMs\":56700,\"startTime\":\"00:53\",\"endTime\":\"00:56\",\"text\":\"了你呀只能看但是不能吃\"},{\"startMs\":58320,\"endMs\":59960,\"startTime\":\"00:58\",\"endTime\":\"00:59\",\"text\":\"啊我这不是在玩游戏\"},{\"startMs\":59961,\"endMs\":62121,\"startTime\":\"00:59\",\"endTime\":\"01:02\",\"text\":\"我是在领手游内测资格\"},{\"startMs\":62122,\"endMs\":64401,\"startTime\":\"01:02\",\"endTime\":\"01:04\",\"text\":\"内测期间升级就送一千红包\"},{\"startMs\":64402,\"endMs\":66721,\"startTime\":\"01:04\",\"endTime\":\"01:06\",\"text\":\"而且上线就送价值十万元宝的\"},{\"startMs\":66722,\"endMs\":67561,\"startTime\":\"01:06\",\"endTime\":\"01:07\",\"text\":\"企业礼包\"},{\"startMs\":67562,\"endMs\":69901,\"startTime\":\"01:07\",\"endTime\":\"01:09\",\"text\":\"我得赶紧领个空气\"},{\"startMs\":70320,\"endMs\":72000,\"startTime\":\"01:10\",\"endTime\":\"01:12\",\"text\":\"你不信点评论区链接试试\"},{\"startMs\":72001,\"endMs\":73581,\"startTime\":\"01:12\",\"endTime\":\"01:13\",\"text\":\"内在期间苗林\"},{\"startMs\":73760,\"endMs\":76060,\"startTime\":\"01:13\",\"endTime\":\"01:16\",\"text\":\"那你现在怎么连龙虾都舍不得吃啊\"},{\"startMs\":76160,\"endMs\":78220,\"startTime\":\"01:16\",\"endTime\":\"01:18\",\"text\":\"以前不能吃大龙虾吗\"},{\"startMs\":79840,\"endMs\":82000,\"startTime\":\"01:19\",\"endTime\":\"01:22\",\"text\":\"啊我今天就想吃青椒炒阿米卷饼\"},{\"startMs\":82001,\"endMs\":84161,\"startTime\":\"01:22\",\"endTime\":\"01:24\",\"text\":\"我一听你说话就气的想\"},{\"startMs\":84162,\"endMs\":85481,\"startTime\":\"01:24\",\"endTime\":\"01:25\",\"text\":\"把你塞给抠了\"},{\"startMs\":85482,\"endMs\":86761,\"startTime\":\"01:25\",\"endTime\":\"01:26\",\"text\":\"拉了就拉了\"},{\"startMs\":86762,\"endMs\":88241,\"startTime\":\"01:26\",\"endTime\":\"01:28\",\"text\":\"还就想吃青椒炒阿米\"},{\"startMs\":88242,\"endMs\":90361,\"startTime\":\"01:28\",\"endTime\":\"01:30\",\"text\":\"还不是因为青椒炒阿米便宜吗\"},{\"startMs\":90362,\"endMs\":91481,\"startTime\":\"01:30\",\"endTime\":\"01:31\",\"text\":\"你要有我的条件\"},{\"startMs\":91482,\"endMs\":93541,\"startTime\":\"01:31\",\"endTime\":\"01:33\",\"text\":\"不也弄一门大虾炒青椒啊\"},{\"startMs\":93600,\"endMs\":95700,\"startTime\":\"01:33\",\"endTime\":\"01:35\",\"text\":\"懒得跟你讲你那也不是大虾\"},{\"startMs\":96280,\"endMs\":97300,\"startTime\":\"01:36\",\"endTime\":\"01:37\",\"text\":\"我这不是大虾\"},{\"startMs\":97360,\"endMs\":99880,\"startTime\":\"01:37\",\"endTime\":\"01:39\",\"text\":\"来我这些虾绳拿着决明吧\"},{\"startMs\":99881,\"endMs\":102341,\"startTime\":\"01:39\",\"endTime\":\"01:42\",\"text\":\"就我这一个虾绳都比那些虾米大\"},{\"startMs\":102960,\"endMs\":105220,\"startTime\":\"01:42\",\"endTime\":\"01:45\",\"text\":\"咦咋的儿子\"},{\"startMs\":106240,\"endMs\":109100,\"startTime\":\"01:46\",\"endTime\":\"01:49\",\"text\":\"妈妈你的青椒炒虾米来了\"},{\"startMs\":109800,\"endMs\":110620,\"startTime\":\"01:49\",\"endTime\":\"01:50\",\"text\":\"啊\"},{\"startMs\":111720,\"endMs\":113020,\"startTime\":\"01:51\",\"endTime\":\"01:53\",\"text\":\"谢谢妈妈\"},{\"startMs\":113160,\"endMs\":114240,\"startTime\":\"01:53\",\"endTime\":\"01:54\",\"text\":\"儿子快吃吧\"},{\"startMs\":114241,\"endMs\":116061,\"startTime\":\"01:54\",\"endTime\":\"01:56\",\"text\":\"这个虾米刚好给我卷一块饼\"},{\"startMs\":120880,\"endMs\":121960,\"startTime\":\"02:00\",\"endTime\":\"02:01\",\"text\":\"慢点吃别急\"},{\"startMs\":121961,\"endMs\":123821,\"startTime\":\"02:01\",\"endTime\":\"02:03\",\"text\":\"嗯哎小伙子\"},{\"startMs\":125120,\"endMs\":126940,\"startTime\":\"02:05\",\"endTime\":\"02:06\",\"text\":\"咋了大妈你等一会\"},{\"startMs\":127160,\"endMs\":129360,\"startTime\":\"02:07\",\"endTime\":\"02:09\",\"text\":\"儿子咱们这下场不要吃\"},{\"startMs\":129361,\"endMs\":129801,\"startTime\":\"02:09\",\"endTime\":\"02:09\",\"text\":\"一会留给你\"},{\"startMs\":129802,\"endMs\":131981,\"startTime\":\"02:09\",\"endTime\":\"02:11\",\"text\":\"小伙子再回去传一回青椒大肠\"},{\"startMs\":133160,\"endMs\":134420,\"startTime\":\"02:13\",\"endTime\":\"02:14\",\"text\":\"哈哈哈\"}]}",
        scene: "{\"frames\":[{\"startTime\":0,\"endTime\":6000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-0000.png\"},{\"startTime\":6000,\"endTime\":13000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-0209.png\"},{\"startTime\":13000,\"endTime\":20000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-0418.png\"},{\"startTime\":20000,\"endTime\":26000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-0627.png\"},{\"startTime\":26000,\"endTime\":32000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-0780.png\"},{\"startTime\":32000,\"endTime\":39000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-0980.png\"},{\"startTime\":39000,\"endTime\":46000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-1174.png\"},{\"startTime\":46000,\"endTime\":51000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-1383.png\"},{\"startTime\":51000,\"endTime\":58000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-1542.png\"},{\"startTime\":58000,\"endTime\":64000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-1751.png\"},{\"startTime\":64000,\"endTime\":70000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-1932.png\"},{\"startTime\":70000,\"endTime\":75000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-2102.png\"},{\"startTime\":75000,\"endTime\":81000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-2279.png\"},{\"startTime\":81000,\"endTime\":88000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-2448.png\"},{\"startTime\":88000,\"endTime\":94000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-2645.png\"},{\"startTime\":94000,\"endTime\":100000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-2849.png\"},{\"startTime\":100000,\"endTime\":106000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-3026.png\"},{\"startTime\":106000,\"endTime\":112000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-3205.png\"},{\"startTime\":112000,\"endTime\":119000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-3388.png\"},{\"startTime\":119000,\"endTime\":125000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-3597.png\"},{\"startTime\":125000,\"endTime\":131000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-3776.png\"},{\"startTime\":131000,\"endTime\":132000,\"url\":\"localhost:3001/static/downloads/7412309962103213345/frames/frame-3958.png\"}]}",
        createdAt: new Date().toString()
      })
      .execute();

    res.status(200).json({ id });
  } catch (err) {
    res.status(500).json({ message: 'An error has occurred.' });
    logger.error(err.message);
  }
});

export default router;
